# NGINX Configuration
events {}

rtmp {
    server {
        listen 1935; # Standard RTMP port

        application live {
            live on;
            hls on;
            hls_path /tmp/hls;
            hls_fragment 10s; # Duration of each HLS fragment
            hls_playlist_length 5m; # Maximum playlist duration

            # Authentication for stream publishing
            on_publish http://desolate-hollows-25888-090f4424c68b.herokuapp.com/auth;
        }
    }
}

http {
    server {
        # Listen on port 80 for HTTP traffic
        listen 80;

        # Serve static files (e.g., index.html)
        location / {
            root /www;           # Ensure this matches the directory where index.html is located
            index index.html;    # Default file to serve
            try_files $uri $uri/ =404;  # Serve files or return 404
            add_header Access-Control-Allow-Origin *; # Allow cross-origin requests
        }

        # Serve HLS streams
        location /hls {
            types {
                application/vnd.apple.mpegurl m3u8;
                application/octet-stream ts;
            }
            root /tmp;           # Directory where HLS fragments are stored
            add_header Cache-Control no-cache;         # Prevent caching
            add_header Access-Control-Allow-Origin *;  # Allow cross-origin requests
        }

        # Optional: Proxy WebSocket connections
        location /ws {
            proxy_pass http://localhost:8081;  # Internal WebSocket server
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
            proxy_set_header Host $host;
        }
    }
}
